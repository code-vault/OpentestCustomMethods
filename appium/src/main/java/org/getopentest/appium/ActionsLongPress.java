package org.getopentest.appium;

import io.appium.java_client.MobileElement;
import io.appium.java_client.touch.offset.PointOption;
import org.getopentest.annotations.TestActionArgument;
import org.getopentest.annotations.TestActionClass;
import org.getopentest.annotations.Type;
import org.getopentest.appium.core.AppiumTestAction;
import org.openqa.selenium.By;
import org.openqa.selenium.Dimension;
import org.openqa.selenium.Point;

@TestActionClass(
        description = "Performs a long press action on an element or at the specified coordinates.")
@TestActionArgument(
        name = "locator", type = Type.OBJECT, optional = true,
        description = "Locator object that identifies the element to press on.")
@TestActionArgument(
        name = "xOffset", type = Type.INTEGER, optional = true,
        description = "The offset on the X axis, relative to the center of the element.")
@TestActionArgument(
        name = "yOffset", type = Type.INTEGER, optional = true,
        description = "The offset on the Y axis, relative to the center of the element.")
@TestActionArgument(
        name = "x", type = Type.INTEGER, optional = true,
        description = "The X coordinate to press at.")
@TestActionArgument(
        name = "y", type = Type.INTEGER, optional = true,
        description = "The Y coordinate to press at.")

public class ActionsLongPress extends AppiumTestAction {

    @Override
    public void run() {
        super.run();

        By locator = this.readLocatorArgument("locator", null);
        Integer xOffset = this.readIntArgument("xOffset", 0);
        Integer yOffset = this.readIntArgument("yOffset", 0);
        Integer x = this.readIntArgument("x", null);
        Integer y = this.readIntArgument("y", null);

        if (locator != null) {
            MobileElement element = this.getElement(locator);
            Point position = element.getLocation();
            Dimension dimension = element.getSize();
            int xCoord = position.x + (dimension.width / 2) + xOffset;
            int yCoord = position.y + (dimension.height / 2) + yOffset;

            AppiumTestAction.getActionsInstance().longPress(PointOption.point(
                    xCoord, yCoord));
        } else if (x != null && y != null) {
            AppiumTestAction.getActionsInstance().longPress(PointOption.point(x, y));
        } else {
            throw new RuntimeException(
                    "You must either provide the locator argument of the element to press, "
                    + "or the x and y arguments to indicate the exact coordinates to press at.");
        }
    }
}
