package org.getopentest.appium;

import io.appium.java_client.MobileElement;
import org.getopentest.annotations.TestActionArgument;
import org.getopentest.annotations.TestActionClass;
import org.getopentest.annotations.TestActionOutput;
import org.getopentest.annotations.Type;
import org.getopentest.appium.core.SwipingAction;
import org.getopentest.logging.Logger;
import org.openqa.selenium.By;
import org.openqa.selenium.Dimension;
import org.openqa.selenium.Point;

@TestActionClass(
        description = "Reads the position and size of a UI element.")
@TestActionArgument(name = "locator", type = Type.MAP, optional = false,
        description = "The locator of the UI element.")
@TestActionOutput(name = "x", type = Type.INTEGER,
        description = "The x position of the upper-left corner of the UI element.")
@TestActionOutput(name = "y", type = Type.INTEGER,
        description = "The y position of the upper-left corner of the UI element.")
@TestActionOutput(name = "width", type = Type.INTEGER,
        description = "The width of the UI element.")
@TestActionOutput(name = "height", type = Type.INTEGER,
        description = "The height of the UI element.")

/**
 * Reads the position and size of a UI element.
 */
public class ReadElementAspect extends SwipingAction {

    @Override
    public void run() {
        super.run();
        
        By locator = readLocatorArgument("locator");
        
        this.swipeAndCheckElementVisible(locator, this.getSwipeOptions());

        MobileElement element = this.getElement(locator);
        Point point = element.getLocation();

        int x = point.getX();
        int y = point.getY();

        Dimension size = element.getSize();
        int width = size.width;
        int height = size.height;
        
        Logger.trace(String.format("The element aspect is (%s,%s,%s,%s)",
                x, y, width, height));

        this.writeOutput("x", x);
        this.writeOutput("y", y);
        this.writeOutput("width", width);
        this.writeOutput("height", height);
    }

}
