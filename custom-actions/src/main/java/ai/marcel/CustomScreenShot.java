package ai.marcel;

import java.io.File;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Date;

import org.apache.commons.io.FileUtils;
import org.getopentest.annotations.TestActionArgument;
import org.getopentest.annotations.Type;
import org.getopentest.appium.core.AppiumTestAction;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.TakesScreenshot;

@TestActionArgument(name = "path", type = Type.OBJECT, optional = false, description = "Folder path for the file.")
@TestActionArgument(name = "fileName", type = Type.OBJECT, optional = true, description = "Filename.")
public class CustomScreenShot extends AppiumTestAction{
	
	private void takeScreenShot(String path, String fileName) throws IOException{
		String lastFileName = "";
		if (fileName == "") {
			String datePattern = "MM-dd-yyyy";
			SimpleDateFormat simpleDateFormat = new SimpleDateFormat(datePattern);
			String date = simpleDateFormat.format(new Date());
			System.out.println(date);
			String timePattern = "HH-MM";
			simpleDateFormat = new SimpleDateFormat(timePattern);
			String time = simpleDateFormat.format(new Date());
			lastFileName = date + time;
		}
		String fullFilePath = path + "/" + lastFileName;
		File file  = ((TakesScreenshot)driver).getScreenshotAs(OutputType.FILE);
		FileUtils.copyFile(file, new File(fullFilePath));
	}
	
	@Override
	public void run(){
		String path = this.readStringArgument("path");
        String fileName = this.readStringArgument("fileName", "");
		try {
			takeScreenShot(path, fileName);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
}
	