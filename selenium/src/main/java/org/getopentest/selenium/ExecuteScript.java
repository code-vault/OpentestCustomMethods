package org.getopentest.selenium;

import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.TimeUnit;
import org.getopentest.selenium.core.SeleniumTestAction;
import org.openqa.selenium.JavascriptExecutor;

public class ExecuteScript extends SeleniumTestAction{

    @Override
    public void run() {
        super.run();

        String script = this.readStringArgument("script");
        List<Object> scriptArgs = this.readArrayArgument("scriptArgs", Object.class, new ArrayList<Object>());
        Boolean async = this.readBooleanArgument("async", false);
        Integer timeoutSec = this.readIntArgument("timeoutSec", 20);

        this.waitForAsyncCallsToFinish();
        
        driver.manage().timeouts().setScriptTimeout(timeoutSec, TimeUnit.SECONDS);	
        JavascriptExecutor jsExecutor = (JavascriptExecutor)driver;
        if (async) {
            Object result = jsExecutor.executeAsyncScript(script, scriptArgs.toArray());
            this.writeOutput("result", result);
        } else {
            Object result = jsExecutor.executeScript(script, scriptArgs.toArray());
            this.writeOutput("result", result);
        }
    }
}   
